<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Celestia - Monaco Editor</title>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: rgb(17,17,17);
      font-family: sans-serif;
      color: #ccc;
    }
    #app {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #tab-bar {
      display: flex;
      align-items: center;
      background: rgb(17,17,17);
      border-bottom: 1px solid #333;
      padding: 4px;
    }
    #tabs-container {
      display: flex;
      gap: 4px;
      flex: 1;
    }
    .tab {
      background: rgb(45,45,45);
      padding: 4px 10px;
      border-radius: 4px 4px 0 0;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      border: 1px solid #333;
      border-bottom: none;
      user-select: none;
      color: #ccc;
    }
    .tab.active {
      background: #1e1e1e;
    }
    .tab .close-btn {
      cursor: pointer;
      color: #888;
      font-weight: bold;
    }
    .tab .close-btn:hover {
      color: #fff;
    }
    .add-tab-button {
      background: transparent;
      border: none;
      cursor: pointer;
      color: #ccc;
      font-size: 18px;
      padding: 0 6px;
    }
    #editor-container {
      flex: 1;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="tab-bar">
      <div id="tabs-container"></div>
      <button id="add-tab-btn" class="add-tab-button">+</button>
    </div>
    <div id="editor-container"></div>
  </div>

  <script>
    let editor;
    let tabs = [];
    let currentTabIndex = 0;

    // Create editor once Monaco is loaded
    require.config({ paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs" } });
    require(["vs/editor/editor.main"], function () {
      editor = monaco.editor.create(document.getElementById("editor-container"), {
        value: "",
        language: "lua",
        theme: "vs-dark",
        automaticLayout: true,
        minimap: { enabled: false },
        cursorBlinking: "smooth"
      });

      // Start with one tab
      tabs.push({ name: "Tab 1", content: 'print("Hello User, and welcome to Celestia!")' });
      renderTabs();
      switchTab(0);

      document.getElementById("add-tab-btn").addEventListener("click", () => {
        tabs.push({ name: "Tab " + (tabs.length + 1), content: "-- New file" });
        renderTabs();
        switchTab(tabs.length - 1);
      });
    });

    function renderTabs() {
      const container = document.getElementById("tabs-container");
      container.innerHTML = "";
      tabs.forEach((tab, i) => {
        const el = document.createElement("div");
        el.className = "tab" + (i === currentTabIndex ? " active" : "");
        el.innerHTML = `<span>${tab.name}</span><span class="close-btn">Ã—</span>`;

        // Click to switch
        el.querySelector("span").addEventListener("click", () => switchTab(i));
        // Close button
        el.querySelector(".close-btn").addEventListener("click", (e) => {
          e.stopPropagation();
          closeTab(i);
        });

        container.appendChild(el);
      });
    }

    function switchTab(index) {
      if (tabs[currentTabIndex]) {
        tabs[currentTabIndex].content = editor.getValue();
      }
      currentTabIndex = index;
      editor.setValue(tabs[index].content);
      renderTabs();
    }

    function closeTab(index) {
      if (tabs.length === 1) return; // never close the last tab
      tabs[index].content = editor.getValue();
      tabs.splice(index, 1);

      if (currentTabIndex >= index) {
        currentTabIndex = Math.max(0, currentTabIndex - 1);
      }
      renderTabs();
      switchTab(currentTabIndex);
    }
  </script>
</body>
</html>
