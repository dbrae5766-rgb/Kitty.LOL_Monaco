<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Lua Editor</title>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    #container {
      width: 100%;
      height: 100%;
    }
    /* Optional: styling for squiggly error underline */
    .squiggly-error {
      text-decoration: red wavy underline;
    }
  </style>
  <!-- Load Monaco from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
</head>
<body>
  <div id="container"></div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' } });

      let editor;
      let Proposals = [];

      require(['vs/editor/editor.main'], function () {
        // --- Completion provider ---
        monaco.languages.registerCompletionItemProvider('lua', {
          provideCompletionItems: () => Proposals
        });

        // --- Themes ---
        monaco.editor.defineTheme('net-theme-light', {
          base: 'vs',
          inherit: true,
          rules: [
            { token: 'global', foreground: '000000' },
            { token: 'keyword', foreground: 'ff6a00' },
            { token: 'comment', foreground: '666666' },
            { token: 'number', foreground: 'ffc600' },
            { token: 'string', foreground: 'ff8c3a' },
          ]
        });

        monaco.editor.defineTheme('net-theme-dark', {
          base: 'vs-dark',
          inherit: true,
          rules: [
            { token: 'global', foreground: 'FFFFFF', fontStyle: "bold" },
            { token: 'keyword', foreground: 'ff6a00', fontStyle: "bold" },
            { token: 'comment', foreground: '666666' },
            { token: 'number', foreground: 'ffc600' },
            { token: 'string', foreground: 'ff8c3a' },
          ]
        });

        // --- Create editor ---
        editor = monaco.editor.create(document.getElementById('container'), {
          value: 'print("Hello User, and welcome to Kitty.lol")',
          language: 'lua',
          theme: 'net-theme-dark',
          folding: true,
          scrollbar: { verticalHasArrows: true },
          dragAndDrop: true,
          links: false,
          minimap: { enabled: false },
          showFoldingControls: "always",
          smoothScrolling: true,
        });

        window.addEventListener("resize", () => editor.layout());

        // === Your API functions still work ===
        window.GetText = () => editor.getValue();
        window.SetText = (x) => editor.setValue(x);
        window.SetTheme = (themeName) => {
          if (themeName === "Dark") monaco.editor.setTheme("net-theme-dark");
          if (themeName === "Light") monaco.editor.setTheme("net-theme-light");
        };
        window.SwitchMinimap = (flag) => editor.updateOptions({ minimap: { enabled: flag } });
        window.SwitchReadonly = (flag) => editor.updateOptions({ readOnly: flag });
        window.SwitchRenderWhitespace = (op) => editor.updateOptions({ renderWhitespace: op });
        window.SwitchLinks = (flag) => editor.updateOptions({ links: flag });
        window.SwitchLineHeight = (num) => editor.updateOptions({ lineHeight: num });
        window.SwitchFontSize = (num) => editor.updateOptions({ fontSize: num });
        window.SwitchFolding = (flag) => editor.updateOptions({ folding: flag });
        window.SwitchAutoIndent = (flag) => editor.updateOptions({ autoIndent: flag });
        window.SwitchFontFamily = (name) => editor.updateOptions({ fontFamily: name });
        window.SwitchFontLigatures = (flag) => editor.updateOptions({ fontLigatures: flag });
        window.ShowErr = (line, column, endline, endcolumn, errMessage) => {
          editor.revealPositionInCenter({ lineNumber: line, column: column });
          editor.deltaDecorations([], [{
            range: new monaco.Range(line, column, endline, endcolumn),
            options: {
              inlineClassName: 'squiggly-error',
              hoverMessage: { value: errMessage },
            },
          }]);
        };
        window.AddIntellisense = (l, k, d, i) => {
          let kindMap = monaco.languages.CompletionItemKind;
          let t = kindMap[k] || kindMap.Text;
          Proposals.push({ label: l, kind: t, detail: d, insertText: i });
        };
        window.SetScroll = (line) => editor.revealLineInCenter({ lineNumber: line });
        window.Refresh = () => {
          let text = editor.getValue();
          editor.setValue("");
          editor.trigger('keyboard', 'type', { text });
        };
      });
    });
  </script>
</body>
</html>
